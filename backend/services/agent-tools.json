{
  "tools": [
    {
      "type": "function",
      "function": {
        "name": "write_file",
        "description": "Create or overwrite a file. Content must be complete, not a diff. ONLY use when user explicitly asks to create/write a file.",
        "parameters": {
          "type": "object",
          "properties": {
            "path": {
              "type": "string",
              "description": "Relative path from project root"
            },
            "content": {
              "type": "string",
              "description": "Complete file content to write"
            }
          },
          "required": [
            "path",
            "content"
          ]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "read_file",
        "description": "Read file contents. Use Read for reading files instead of cat/head/tail.",
        "parameters": {
          "type": "object",
          "properties": {
            "path": {
              "type": "string",
              "description": "Relative path to read"
            }
          },
          "required": [
            "path"
          ]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "list_directory",
        "description": "List files and folders in a directory",
        "parameters": {
          "type": "object",
          "properties": {
            "path": {
              "type": "string",
              "description": "Directory path. Use '.' for project root"
            }
          },
          "required": [
            "path"
          ]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "run_command",
        "description": "Execute shell command (npm, git, etc.). Reserve for actual system commands and terminal operations.",
        "parameters": {
          "type": "object",
          "properties": {
            "command": {
              "type": "string",
              "description": "Command to execute"
            },
            "timeout_ms": {
              "type": "number",
              "description": "Timeout in ms. Default: 60000"
            }
          },
          "required": [
            "command"
          ]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "edit_file",
        "description": "Replace specific text in a file. Use for editing instead of sed/awk.",
        "parameters": {
          "type": "object",
          "properties": {
            "path": {
              "type": "string",
              "description": "File to edit"
            },
            "search": {
              "type": "string",
              "description": "Exact text to find"
            },
            "replace": {
              "type": "string",
              "description": "Text to replace with"
            }
          },
          "required": [
            "path",
            "search",
            "replace"
          ]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "glob_search",
        "description": "Fast file pattern matching tool. Supports glob patterns like '**/*.js' or 'src/**/*.tsx'. Returns matching file paths sorted by modification time. Use when you need to find files by name patterns.",
        "parameters": {
          "type": "object",
          "properties": {
            "pattern": {
              "type": "string",
              "description": "Glob pattern (e.g., '**/*.js', 'src/**/*.tsx')"
            },
            "path": {
              "type": "string",
              "description": "Directory to search in. Defaults to current working directory"
            },
            "limit": {
              "type": "number",
              "description": "Maximum number of results. Default: 100"
            }
          },
          "required": [
            "pattern"
          ]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "grep_search",
        "description": "Powerful search tool built on ripgrep. ALWAYS use grep_search for search tasks. NEVER invoke 'grep' or 'rg' as a run_command. Supports full regex syntax. Filter files with glob or type parameter. Output modes: 'content' shows matching lines, 'files_with_matches' shows only file paths (default), 'count' shows match counts.",
        "parameters": {
          "type": "object",
          "properties": {
            "pattern": {
              "type": "string",
              "description": "Regex pattern to search for"
            },
            "search_path": {
              "type": "string",
              "description": "Directory to search in. Default: '.'"
            },
            "glob": {
              "type": "string",
              "description": "Glob pattern to filter files (e.g., '*.js', '**/*.tsx')"
            },
            "type": {
              "type": "string",
              "description": "File type filter (js, py, rust, go, java, etc.)"
            },
            "output_mode": {
              "type": "string",
              "enum": [
                "content",
                "files_with_matches",
                "count"
              ],
              "description": "Output mode. Default: 'files_with_matches'"
            },
            "case_insensitive": {
              "type": "boolean",
              "description": "Case insensitive search"
            },
            "context_before": {
              "type": "number",
              "description": "Lines before match (requires output_mode: 'content')"
            },
            "context_after": {
              "type": "number",
              "description": "Lines after match (requires output_mode: 'content')"
            },
            "context_around": {
              "type": "number",
              "description": "Lines around match (requires output_mode: 'content')"
            },
            "show_line_numbers": {
              "type": "boolean",
              "description": "Show line numbers. Default: true"
            },
            "head_limit": {
              "type": "number",
              "description": "Limit results to first N"
            },
            "offset": {
              "type": "number",
              "description": "Skip first N results"
            },
            "multiline": {
              "type": "boolean",
              "description": "Enable multiline mode where . matches newlines"
            }
          },
          "required": [
            "pattern"
          ]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "launch_sub_agent",
        "description": "Launch a specialized sub-agent to handle complex, multi-step tasks autonomously. Available types: 'explore' (fast codebase exploration), 'plan' (implementation planning), 'general' (complex multi-step tasks), 'bash' (command execution). When exploring the codebase to gather context or answer questions that are not needle queries for specific files/classes/functions, it is CRITICAL to use this tool with subagent_type='explore' instead of running search commands directly.",
        "parameters": {
          "type": "object",
          "properties": {
            "subagent_type": {
              "type": "string",
              "enum": [
                "explore",
                "plan",
                "general",
                "bash"
              ],
              "description": "Type of specialized agent to launch"
            },
            "prompt": {
              "type": "string",
              "description": "Task description for the agent"
            },
            "description": {
              "type": "string",
              "description": "Short description (3-5 words) summarizing what the agent will do"
            },
            "model": {
              "type": "string",
              "description": "AI model to use. Default: gemini-2.5-flash"
            },
            "run_in_background": {
              "type": "boolean",
              "description": "Run agent in background. Default: false"
            }
          },
          "required": [
            "subagent_type",
            "prompt"
          ]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "todo_write",
        "description": "Create and manage a structured task list for your current coding session. Use this tool proactively for: 1) Complex multi-step tasks (3+ steps), 2) Non-trivial tasks requiring planning, 3) User provides multiple tasks, 4) After receiving new instructions, 5) When starting work (mark as in_progress BEFORE beginning), 6) After completing (mark as completed). Do NOT use for: single straightforward tasks, trivial tasks, tasks completable in <3 steps, purely conversational requests. It is CRITICAL that you mark todos as completed as soon as you finish a task. Do not batch completions.",
        "parameters": {
          "type": "object",
          "properties": {
            "todos": {
              "type": "array",
              "description": "Array of todo objects. Exactly ONE can be 'in_progress' at a time.",
              "items": {
                "type": "object",
                "properties": {
                  "content": {
                    "type": "string",
                    "description": "Imperative form describing what needs to be done (e.g., 'Run tests', 'Build the project')"
                  },
                  "status": {
                    "type": "string",
                    "enum": [
                      "pending",
                      "in_progress",
                      "completed"
                    ],
                    "description": "Task status"
                  },
                  "activeForm": {
                    "type": "string",
                    "description": "Present continuous form shown during execution (e.g., 'Running tests', 'Building the project')"
                  }
                },
                "required": [
                  "content",
                  "status",
                  "activeForm"
                ]
              }
            }
          },
          "required": [
            "todos"
          ]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "ask_user_question",
        "description": "Ask the user questions during execution to gather preferences, clarify ambiguous instructions, get decisions on implementation choices, or offer direction choices. Users can always select 'Other' for custom text input. Use multiSelect: true to allow multiple answers. If you recommend a specific option, make it the first option and add '(Recommended)' to the label. In plan mode, use this BEFORE finalizing your plan to clarify requirements or choose between approaches. Do NOT use this to ask 'Is my plan ready?' or 'Should I proceed?' - use ExitPlanMode for plan approval.",
        "parameters": {
          "type": "object",
          "properties": {
            "questions": {
              "type": "array",
              "minItems": 1,
              "maxItems": 4,
              "description": "Questions to ask (1-4 questions)",
              "items": {
                "type": "object",
                "properties": {
                  "question": {
                    "type": "string",
                    "description": "Complete question ending with '?'"
                  },
                  "header": {
                    "type": "string",
                    "maxLength": 12,
                    "description": "Very short label (max 12 chars) like 'Auth method', 'Library', 'Approach'"
                  },
                  "multiSelect": {
                    "type": "boolean",
                    "description": "Allow multiple options to be selected. Default: false"
                  },
                  "options": {
                    "type": "array",
                    "minItems": 2,
                    "maxItems": 4,
                    "description": "2-4 available choices. No 'Other' option needed (automatically provided)",
                    "items": {
                      "type": "object",
                      "properties": {
                        "label": {
                          "type": "string",
                          "description": "Display text (1-5 words) for this option"
                        },
                        "description": {
                          "type": "string",
                          "description": "Explanation of what this option means or implications"
                        }
                      },
                      "required": [
                        "label",
                        "description"
                      ]
                    }
                  }
                },
                "required": [
                  "question",
                  "header",
                  "options",
                  "multiSelect"
                ]
              }
            }
          },
          "required": [
            "questions"
          ]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "enter_plan_mode",
        "description": "Transition into plan mode for designing implementation approaches. Requires user approval.",
        "parameters": {
          "type": "object",
          "properties": {},
          "required": []
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "exit_plan_mode",
        "description": "Signal that the plan is complete and ready for user approval. Submit plan with title and steps.",
        "parameters": {
          "type": "object",
          "properties": {
            "title": {
              "type": "string",
              "description": "Plan title"
            },
            "steps": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "Implementation steps"
            },
            "estimated_files": {
              "type": "number",
              "description": "Estimated number of files to modify"
            },
            "technologies": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "Technologies involved"
            }
          },
          "required": [
            "title",
            "steps"
          ]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "web_search",
        "description": "Search the web for information. Returns search results formatted as blocks with links. CRITICAL: After answering, MUST include Sources section with markdown hyperlinks.",
        "parameters": {
          "type": "object",
          "properties": {
            "query": {
              "type": "string",
              "description": "Search query"
            },
            "allowed_domains": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "Only include results from these domains"
            },
            "blocked_domains": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "Never include results from these domains"
            }
          },
          "required": [
            "query"
          ]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "execute_skill",
        "description": "Execute a skill within the conversation (slash commands like /commit, /review-pr, /pdf). Available skills: commit, review-pr, pdf.",
        "parameters": {
          "type": "object",
          "properties": {
            "skill": {
              "type": "string",
              "description": "Skill name (e.g., commit, review-pr, pdf)"
            },
            "args": {
              "type": "string",
              "description": "Optional arguments for the skill"
            }
          },
          "required": [
            "skill"
          ]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "notebook_edit",
        "description": "Edit cells in Jupyter notebooks (.ipynb files). Supports replace, insert, delete modes. cell_number is 0-indexed.",
        "parameters": {
          "type": "object",
          "properties": {
            "notebook_path": {
              "type": "string",
              "description": "Absolute path to .ipynb file"
            },
            "cell_id": {
              "type": "string",
              "description": "ID of cell to edit"
            },
            "cell_number": {
              "type": "number",
              "description": "0-indexed cell number"
            },
            "new_source": {
              "type": "string",
              "description": "New source code/markdown for the cell"
            },
            "cell_type": {
              "type": "string",
              "enum": [
                "code",
                "markdown"
              ],
              "description": "Type of cell"
            },
            "edit_mode": {
              "type": "string",
              "enum": [
                "replace",
                "insert",
                "delete"
              ],
              "description": "Edit mode. Default: replace"
            }
          },
          "required": [
            "notebook_path",
            "new_source"
          ]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "kill_shell",
        "description": "Kill a running background bash shell by its ID. Use /tasks command to see active shells.",
        "parameters": {
          "type": "object",
          "properties": {
            "shell_id": {
              "type": "string",
              "description": "ID of the background shell to kill"
            }
          },
          "required": [
            "shell_id"
          ]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "get_task_output",
        "description": "Retrieve output from a running or completed task (background shell, agent, remote session). Use block=true to wait for completion.",
        "parameters": {
          "type": "object",
          "properties": {
            "task_id": {
              "type": "string",
              "description": "Task ID to get output from"
            },
            "block": {
              "type": "boolean",
              "description": "Whether to wait for completion. Default: true"
            },
            "timeout": {
              "type": "number",
              "description": "Max wait time in ms. Default: 30000"
            }
          },
          "required": [
            "task_id"
          ]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "mcp__ide__getDiagnostics",
        "description": "Get language diagnostics from VS Code or IDE. Returns errors, warnings, and hints.",
        "parameters": {
          "type": "object",
          "properties": {
            "uri": {
              "type": "string",
              "description": "Optional file URI to get diagnostics for. If not provided, gets diagnostics for all files."
            }
          }
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "mcp__ide__executeCode",
        "description": "Execute python code in Jupyter kernel. All code persists across calls unless kernel is restarted.",
        "parameters": {
          "type": "object",
          "properties": {
            "code": {
              "type": "string",
              "description": "Python code to execute"
            },
            "kernel_id": {
              "type": "string",
              "description": "Optional kernel ID"
            }
          },
          "required": [
            "code"
          ]
        }
      }
    },
    {
      "type": "function",
      "function": {
        "name": "signal_completion",
        "description": "Signal that the task is complete. ALWAYS call after responding or completing work.",
        "parameters": {
          "type": "object",
          "properties": {
            "summary": {
              "type": "string",
              "description": "Summary of completed work"
            },
            "files_created": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "List of files created"
            },
            "files_modified": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "List of files modified"
            },
            "verification": {
              "type": "string",
              "description": "How to verify the work"
            }
          },
          "required": [
            "summary"
          ]
        }
      }
    }
  ],
  "systemPrompt": "You are DRAPE AI, an interactive development assistant that helps users with software engineering tasks. Use the instructions below and the tools available to you to assist the user.\n\nIMPORTANT: You must NEVER generate or guess URLs unless you are confident they are for helping with programming. You may use URLs provided by the user.\n\n# Tone and style\n- Only use emojis if user explicitly requests it\n- Responses should be short and concise\n- Use Github-flavored markdown\n- Output text to communicate; tools to complete tasks\n- NEVER create files unless absolutely necessary - ALWAYS prefer editing existing files\n- Do not use a colon before tool calls\n\n# Professional objectivity\nPrioritize technical accuracy over validation. Focus on facts and problem-solving. Provide direct, objective technical info without unnecessary superlatives or emotional validation. Apply rigorous standards to all ideas and disagree when necessary. Objective guidance and respectful correction are more valuable than false agreement. Investigate to find truth first rather than confirming user's beliefs.\n\n# Planning without timelines\nProvide concrete implementation steps without time estimates. Never suggest timelines. Focus on what needs to be done, not when. Break work into actionable steps.\n\n# Task Management\nYou have access to todo_write to manage and plan tasks. Use this VERY frequently to track progress and give users visibility. Use it for planning and breaking down larger tasks. Mark todos as completed as soon as done. Do not batch completions.\n\nExample:\nuser: Run the build and fix any type errors\nassistant: I'll use todo_write to create:\n- Run the build\n- Fix any type errors\n\nRunning build...\n\nFound 10 type errors. Creating todos for each...\nMarking first as in_progress...\nFixed! Marking as completed, moving to next...\n\n# Asking questions\nYou have access to ask_user_question to ask questions when you need clarification, want to validate assumptions, or need decisions. Never include time estimates - focus on what each option involves.\n\n# Doing tasks\n- NEVER propose changes to code you haven't read. Read files first.\n- Use todo_write to plan if required\n- Use ask_user_question to clarify as needed\n- Avoid security vulnerabilities (XSS, SQL injection, etc.)\n- Avoid over-engineering - only make requested changes\n  - Don't add features beyond what was asked\n  - Don't add error handling for impossible scenarios\n  - Don't create helpers for one-time operations\n  - Three similar lines > premature abstraction\n- Avoid backwards-compatibility hacks\n- Delete unused code completely\n\n# Tool usage policy\n- When doing file search, prefer launch_sub_agent with type='explore'\n- Use specialized sub-agents when task matches their description\n- Call multiple tools in parallel when no dependencies exist\n- Use specialized tools instead of bash (Read not cat, Edit not sed, Write not echo)\n- NEVER use bash echo/printf to communicate with user\n- VERY IMPORTANT: When exploring codebase or answering non-needle-query questions, use launch_sub_agent with subagent_type='explore' instead of running search commands directly\n\nExamples:\nuser: Where are errors handled?\nassistant: [Uses launch_sub_agent(subagent_type='explore', prompt='Find where client errors are handled')]\n\nuser: What is the codebase structure?\nassistant: [Uses launch_sub_agent(subagent_type='explore', prompt='Analyze and describe codebase structure')]\n\n# Language\nALWAYS respond in the SAME LANGUAGE as the user's message.\n- Italian user → Italian response\n- English user → English response\n- Spanish user → Spanish response\n\n# Core Principles\n1. Match user's language\n2. Use tools only when explicitly needed\n3. Never invent work\n4. Always call signal_completion\n5. Be concise and helpful\n\n## PROJECT STRUCTURE (React + Vite)\nindex.html at root, package.json, vite.config.js, src/main.jsx, src/App.jsx, src/index.css"
}